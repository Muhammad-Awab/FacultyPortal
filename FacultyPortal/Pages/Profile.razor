@attribute [Authorize(Roles = "Admin")]
@inject IJSRuntime js
@inject AuthenticationStateProvider authStateProvider
@inject IProfile ips
@inject NavigationManager nm

@page "/profile"

<div class="container-fluid">
    <div class="row">
    </div>
    <EditForm Model="_UserProfile">
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-4 text-center">
                    <h2 class="fw-bolder text-center">Profile Settings</h2>

                    <img src="/awab.jfif" alt="Profile Picture" class="img-fluid rounded-circle" style="height:120px; width:150px">
                    <h5 class="mt-3 fw-bolder">Muhammad Awab</h5>
                </div>
            </div>
        </div>

        <div class="container mt-3 ">
            <div class="row">
                <div class="col-md-6 col-sm-10 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example1">Name</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.Name" placeholder="Name" class="form-control form-control-lg border-dark" />

                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example2">Address</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.Location" placeholder="Address" class="form-control form-control-lg border-dark" />

                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example1">Email</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.Email" placeholder="Enter Email" class="form-control form-control-lg border-dark" />

                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example2">Phone Number</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.PhoneNumber" placeholder="Phone Number" class="form-control form-control-lg border-dark" />

                    </div>
                </div>
            </div>


            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example1">Company</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.Company" placeholder="Company Name" class="form-control form-control-lg border-dark " />

                    </div>
                </div>
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example2">Designation</label>
                        <input type="email" id="form2Example17" @bind-value="_UserProfile.Designation"  placeholder=" UI Developer" class="form-control form-control-lg border-dark" />

                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="form-outline">
                        <label class="form-label" for="form3Example1">DateOfBirth</label>
                        <input type="date" id="form2Example17" @bind-value="_UserProfile.DOB" placeholder="24-04-2023" class="form-control form-control-lg border-dark " />

                    </div>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row mt-3">
                <div class="col-md-1  mb-2">
                    <button type="button" @onclick="save" class="btn btn-primary btn-block">UPDATE</button>
                </div>
                <div class="col-md-1">
                    <button type="button" class="btn btn-outline-dark btn-block">CANCEL</button>
                </div>
            </div>
        </div>


    </EditForm>

</div>

@code {

    [CascadingParameter]
    private Task<AuthenticationState> authenticatestate { get; set; }


    EntRegistration _UserProfile = new EntRegistration();
    public string value { get; set; }
    public string[] v;



    protected override async Task  OnInitializedAsync()
    {

        DisplayGreeting();
        v = value.Split(',');
        _UserProfile.UserID = v[0];
        _UserProfile = await ips.LoadUserProfile(_UserProfile);
    }
   
    private async Task DisplayGreeting()
    {
        var authState = await authenticatestate;
        value = $"{authState.User.Identity.Name}";

    }


    public async void save()
    {
        _UserProfile.UserID = v[0];
        await ips.SaveUserProfile(_UserProfile);
    }
}